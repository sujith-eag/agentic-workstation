{
  "$schema": "../../_canonical_schemas/workflow.schema.json",
  "workflow_id": "implementation",
  "name": "implementation",
  "display_name": "Implementation Workflow",
  "version": "1.0.0",
  "description": "Test-driven implementation workflow following the 'Test-First, Trace-Always, Gate-Before-Go' philosophy. A focused team of agents handles project development from scaffolding to deployment, transforming planning artifacts into production-ready code with comprehensive testing and quality assurance.",
  "author": "agentic-workflow-os",
  "created": "2025-11-29",
  "updated": "2025-12-04",
  "tags": ["software", "implementation", "tdd", "development", "coding"],
  "display": {
    "agent_prefix": "I",
    "orch_id": "I-00",
    "id_format": "canonical",
    "focus": "implementation",
    "base_rules": [
      "**Source of Truth:** `project_index.md` is your file registry",
      "**Inputs:** Read from paths listed in `consumes` (frontmatter)",
      "**Outputs:** Write to paths listed in `produces` (frontmatter)",
      "**Logging:** See `docs/CLI_REFERENCE.md` for workflow commands",
      "**Implementation Focus:** Write production-ready code with tests"
    ],
    "protocol": {
      "name": "Implementation Protocol",
      "steps": [
        "**On Startup:** Read `project_index.md` → Check stage → Read planning artifacts",
        "**TDD Cycle:** ingest → spec_test → implement → instrument → log",
        "**Gating:** Check gate requirements before proceeding (use `./workflow gate-check`)",
        "**Stage Transitions:** Use `./workflow set-stage <STAGE>` to advance",
        "**Handoffs:** Use `./workflow handoff` to transfer between agents"
      ]
    }
  },
  "cycles": {
    "tdd": {
      "name": "TDD Micro-Cycle",
      "steps": [
        "ingest - Load task and relevant planning artifacts",
        "spec_test - Write failing test",
        "implement - Write code to pass test",
        "instrument - Add logging/metrics",
        "log - Update status artifacts"
      ]
    }
  },
  "pipeline": {
    "order": ["I-00", "I-01", "I-02", "I-03", "I-04", "I-05"],
    "on_demand": ["I-SEC", "I-DOC", "I-DS", "I-PERF"],
    "parallel_groups": [["I-02", "I-03"]],
    "allow_skip": false,
    "allow_parallel": true
  },
  "input_from": {
    "planning": [
      "requirements_spec.md",
      "architecture_overview.md",
      "system_design.md",
      "api_specifications.md",
      "logical_data_model.md",
      "data_strategy.md",
      "traceability_matrix.md",
      "testing_strategy.md",
      "infrastructure_plan.md",
      "secure_design_recommendations.md",
      "business_logic_map.md",
      "interaction_flows.md",
      "conceptual_wireframes.md",
      "implementation_task_list.md",
      "implementation_handoff_plan.md",
      "implementation_feasibility_gap_report.md",
      "integration_consistency_audit.md",
      "cicd_pipeline_plan.md",
      "environment_strategy.md",
      "deployment_model.md",
      "cloud_cost_projection.md",
      "data_governance_plan.md",
      "information_architecture.md",
      "accessibility_compliance_plan.md",
      "user_journeys.md",
      "ux_principles_and_goals.md",
      "test_architecture_plan.md",
      "nonfunctional_validation_plan.md",
      "resilience_architecture_plan.md",
      "quality_governance.md",
      "transition_readiness_summary.md",
      "capacity_planning_model.md",
      "data_lifecycle_plan.md",
      "implementation_readiness_report.md"
    ]
  },
  "stages": [
    {"id": "INTAKE", "description": "Task received, context loaded", "agents": ["I-00", "I-01"]},
    {"id": "SPEC", "description": "Mini-spec created with REQ-ID trace", "agents": ["I-01", "I-02", "I-03"]},
    {"id": "APPROVED", "description": "Human/gate approval granted", "agents": ["I-00", "I-05"]},
    {"id": "TEST_WRITE", "description": "Failing tests authored (TDD red phase)", "agents": ["I-04"]},
    {"id": "IMPLEMENT", "description": "Code written to pass tests (TDD green phase)", "agents": ["I-02", "I-03"]},
    {"id": "INSTRUMENT", "description": "Observability added (logs, metrics, tracing)", "agents": ["I-04"]},
    {"id": "VERIFY", "description": "Tests pass, coverage met, review complete", "agents": ["I-04", "I-05"]},
    {"id": "COMPLETE", "description": "Ready for handoff or release", "agents": ["I-05"]}
  ],
  "metadata": {
    "tdd": {
      "enforce": true,
      "skip_for": ["documentation", "configuration"],
      "require_coverage": 80,
      "max_retry": 3
    },
    
    "gating": {
      "check_point": "before_agent_activation",
      "strict": true,
      "artifacts": [
        "implementation_feasibility_gap_report.md",
        "integration_consistency_audit.md"
      ]
    }
  },
  "governance": {
    "traceability": {
      "req_id_enforcement": true,
      "commit_message_format": "[REQ-ID] Short description\\n\\n- Detail 1\\n- Detail 2\\n\\nTraces: REQ-FUNC-001, REQ-NF-003",
      "matrix_update_rules": "Update traceability_matrix.md when tests implement a requirement or requirement status changes"
    },
    "orthogonal_flags": [
      "blocked",
      "blocker_reason",
      "blocker_artifact",
      "debt_items",
      "revision_count",
      "retry_count",
      "retry_reason"
    ],
    "documentation_requirements": {
      "I-01": ["SETUP.md","INFRASTRUCTURE.md"],
      "I-02": ["backend/README.md","API docstrings"],
      "I-03": ["frontend/README.md","component docs"],
      "I-04": ["Test documentation","coverage reports"],
      "I-05": ["CHANGELOG.md","release_notes.md"]
    },
    "logging_standards": {
      "entry_types": ["INTAKE","DECISION","BLOCKER","RESOLVED","DEBT","HANDOFF"],
      "schema": "timestamp | entry_type | agent_id | ref_ids | summary | status"
    }
  },
  "config": {
    "enforcement": {
      "mode": "strict",
      "checkpoint_gating": "strict",
      "handoff_gating": "strict"
    },
    "logging": {
      "require_session_log": true,
      "require_decision_log": true,
      "require_assumption_log": true,
      "require_handoff_log": true,
      "require_artifact_tracking": true
    },
    "validation": {
      "run_validation_commands": true,
      "timeout_seconds": 30
    },
    "bypass": {
      "require_reason": true,
      "log_bypasses": true
    }
  },
  "globals": {
    "output_requirements": [
      "Code must have corresponding tests before merge.",
      "All code changes must be traceable to REQ-IDs.",
      "Instrumentation (logging, metrics) required for production code.",
      "Documentation inline (docstrings, comments) + README updates."
    ],
    "tdd_cycle": [
      "ingest: Load context, parse requirements",
      "spec_test: Write failing tests (TDD red)",
      "implement: Write code to pass tests (TDD green)",
      "instrument: Add observability (logs, metrics, traces)",
      "log: Document work done (changelog entry)"
    ],
    "gating_rules": [
      "Check gating artifacts BEFORE agent activation.",
      "If blockers found, set blocked=true and halt.",
      "Blockers must be resolved in source artifact before proceeding."
    ]
  },
  "checkpoints": [
    {
      "after_agent": "I-01",
      "type": "human",
      "prompt": "Project structure ready. Proceed to implementation?",
      "owner": "I-01",
      "validation_command": "",
      "timeout_seconds": 30
    },
    {
      "after_agent": "I-03",
      "type": "gate",
      "condition": "unit_tests_pass",
      "prompt": "Backend and frontend unit tests must pass.",
      "owner": "I-03",
      "validation_command": "./workflow validate-checkpoint --after-agent I-03 --check unit_tests_pass",
      "timeout_seconds": 60
    },
    {
      "after_agent": "I-04",
      "type": "human",
      "prompt": "Quality validation complete. Proceed to release?",
      "owner": "I-04",
      "validation_command": "",
      "timeout_seconds": 30
    },
    {
      "after_agent": "I-05",
      "type": "human",
      "prompt": "Release ready for deployment. Approve final release?",
      "owner": "I-05",
      "validation_command": "",
      "timeout_seconds": 30
    }
  ],
  "cli": {
    "extra_commands": ["set-stage", "gate-check", "invoke", "sync-planning"],
    "examples": [
      {"command": "./workflow status", "description": "Show project status"},
      {"command": "./workflow activate I-01", "description": "Activate scaffold agent"},
      {"command": "./workflow set-stage IMPLEMENT", "description": "Set implementation stage"},
      {"command": "./workflow gate-check I-01", "description": "Check gate requirements"}
    ]
  },
  "directories": {
    "root": "projects/{project_name}/",
    "src": "src/",
    "src_backend": "src/backend/",
    "src_frontend": "src/frontend/",
    "src_shared": "src/shared/",
    "tests": "tests/",
    "tests_unit": "tests/unit/",
    "tests_integration": "tests/integration/",
    "tests_e2e": "tests/e2e/",
    "docs": "docs/",
    "infrastructure": "infrastructure/",
    "migrations": "migrations/",
    "scripts": "scripts/",
    "config": "config/",
    "artifacts": "artifacts/",
    "agent_files": "agent_files/",
    "agent_context": "agent_context/",
    "agent_log": "agent_log/",
    "templates": "templates/implementation/"
  }
}
