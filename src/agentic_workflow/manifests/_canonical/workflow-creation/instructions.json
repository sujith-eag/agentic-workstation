{
  "$schema": "../../_canonical_schemas/instructions.schema.json",
  "workflow_id": "workflow-creation",
  "instructions": [
    {
      "id": "W-00",
      "slug": "guide",
      "role": "Workflow Creation Guide",
      "purpose": "Orient users to the workflow creation process and prepare them for Phase 01 (Domain Analysis).",
      "responsibilities": [
        "Welcome user and explain the 8-phase workflow creation process",
        "Ask what kind of workflow they want to create",
        "Explain waterfall model - each phase completes before next",
        "Preview the deliverables they'll create",
        "Confirm user is ready to begin with Phase 01"
      ],
      "workflow": {
        "entry_conditions": [
          "User initiates workflow creation process"
        ],
        "steps": [
          "Welcome user and explain the 8-phase workflow creation process",
          "Ask what kind of workflow they want to create",
          "Explain waterfall model - each phase completes before next",
          "Preview the deliverables they'll create",
          "Confirm user is ready to begin with Phase 01"
        ],
        "exit_conditions": [
          "User understands the 8 phases",
          "User has a workflow concept in mind",
          "User is ready to start domain analysis"
        ]
      },
      "boundaries": {
        "in_scope": [
          "Orientation and explanation",
          "Process overview",
          "User preparation"
        ],
        "out_of_scope": [
          "Domain analysis",
          "Creating workflow files",
          "Technical implementation"
        ]
      },
      "domain_rules": [
        "Do NOT perform domain analysis",
        "Do NOT create any workflow files",
        "Only orient and prepare"
      ],
      "handoff": {
        "next": [ { "id": "W-01" } ],
        "conditions": [
          "User confirms understanding",
          "User has workflow concept"
        ]
      }
    },
    {
      "id": "W-01",
      "slug": "analysis",
      "role": "Domain Analysis Agent",
      "purpose": "Guide user through comprehensive domain analysis to understand the workflow's purpose, phases, and constraints.",
      "responsibilities": [
        "Ask: What is the purpose of this workflow?",
        "Ask: Who will use this workflow?",
        "Ask: What are the major phases or stages?",
        "For each phase, ask: What is the input? What is the output?",
        "Ask: Where should human review happen?",
        "Ask: What constraints or rules apply?",
        "Document all answers in domain_notes.md",
        "Create phase_list.md with ordered phases",
        "Create gate_definitions.md with checkpoints"
      ],
      "workflow": {
        "entry_conditions": [
          "User has workflow concept ready",
          "Orientation complete"
        ],
        "steps": [
          "Ask: What is the purpose of this workflow?",
          "Ask: Who will use this workflow?",
          "Ask: What are the major phases or stages?",
          "For each phase, ask: What is the input? What is the output?",
          "Ask: Where should human review happen?",
          "Ask: What constraints or rules apply?",
          "Document all answers in domain_notes.md",
          "Create phase_list.md with ordered phases",
          "Create gate_definitions.md with checkpoints"
        ],
        "exit_conditions": [
          "Workflow purpose clearly stated",
          "At least 3 phases identified",
          "Each phase has defined input/output",
          "At least 1 quality gate defined",
          "Key constraints documented"
        ]
      },
      "boundaries": {
        "in_scope": [
          "Domain understanding",
          "Phase identification",
          "Checkpoint definition",
          "Constraint documentation"
        ],
        "out_of_scope": [
          "Creating YAML files",
          "Defining agent IDs",
          "Technical structure creation"
        ]
      },
      "domain_rules": [
        "Do NOT create YAML files yet",
        "Do NOT define agent IDs yet",
        "Focus only on domain understanding"
      ],
      "handoff": {
        "next": [ { "id": "W-02" } ],
        "conditions": [
          "domain_notes.md complete",
          "phase_list.md complete",
          "gate_definitions.md complete",
          "Human approves domain analysis"
        ]
      }
    },
    {
      "id": "W-02",
      "slug": "structure",
      "role": "Structure Setup Agent",
      "purpose": "Create the workflow package skeleton with directory structure and stub files.",
      "responsibilities": [
        "Determine workflow name (lowercase, hyphenated)",
        "Create workflow.yaml with metadata from domain notes",
        "Define stages based on phase groupings",
        "Add checkpoints from gate_definitions.md",
        "Create directory structure",
        "Create stub files for agents.yaml, artifacts.yaml, instructions.yaml",
        "Verify skeleton with list-workflows command"
      ],
      "workflow": {
        "entry_conditions": [
          "Domain analysis complete",
          "Phase list approved",
          "Gate definitions finalized"
        ],
        "steps": [
          "Determine workflow name (lowercase, hyphenated)",
          "Create workflow.yaml with metadata from domain notes",
          "Define stages based on phase groupings",
          "Add checkpoints from gate_definitions.md",
          "Create directory structure",
          "Create stub files for agents.yaml, artifacts.yaml, instructions.yaml",
          "Verify skeleton with list-workflows command"
        ],
        "exit_conditions": [
          "workflow.yaml has name, display_name, version, description",
          "Stages defined and match phase groupings",
          "Checkpoints configured",
          "Directory structure created",
          "Workflow appears in list-workflows"
        ]
      },
      "boundaries": {
        "in_scope": [
          "Workflow metadata creation",
          "Directory structure setup",
          "Stage definition",
          "Stub file creation"
        ],
        "out_of_scope": [
          "Full agent definitions",
          "Artifact details",
          "Instruction writing"
        ]
      },
      "domain_rules": [
        "Use correct YAML syntax",
        "Keep stub files minimal",
        "Do NOT define full agents yet"
      ],
      "handoff": {
        "next": [ { "id": "W-03" } ],
        "conditions": [
          "workflow_yaml_draft.md complete",
          "structure_checklist.md verified",
          "list-workflows shows new workflow"
        ]
      }
    },
    {
      "id": "W-03",
      "slug": "agents",
      "role": "Agent Definition Agent",
      "purpose": "Design and define all agents with their roles, artifacts, and handoff relationships.",
      "responsibilities": [
        "Start with W00 guide agent (produces system files only)",
        "For each phase in phase_list.md, define an agent",
        "For each agent, determine: ID, name, slug, role",
        "Write concise description (2-3 sentences)",
        "List produces files (actual filenames, not artifact_ids)",
        "List consumes files (from previous agents)",
        "Identify any on-demand specialist agents needed",
        "Draw handoff flow diagram"
      ],
      "workflow": {
        "entry_conditions": [
          "Workflow skeleton created",
          "Phase list finalized",
          "Directory structure in place"
        ],
        "steps": [
          "Start with W00 guide agent (produces system files only)",
          "For each phase in phase_list.md, define an agent",
          "For each agent, determine: ID, name, slug, role",
          "Write concise description (2-3 sentences)",
          "List produces files (actual filenames, not artifact_ids)",
          "List consumes files (from previous agents)",
          "Identify any on-demand specialist agents needed",
          "Draw handoff flow diagram"
        ],
        "exit_conditions": [
          "One agent per phase plus guide",
          "All agents have produces and consumes lists",
          "Filenames in produces/consumes are consistent",
          "Handoff flow is clear and complete",
          "On-demand agents identified if needed"
        ]
      },
      "boundaries": {
        "in_scope": [
          "Agent role definition",
          "Produces/consumes specification",
          "Handoff flow design",
          "On-demand agent identification"
        ],
        "out_of_scope": [
          "Artifact metadata details",
          "Instruction writing",
          "Template creation"
        ]
      },
      "domain_rules": [
        "Use produces: [file.md] format, NOT artifacts: [{artifact_id}]",
        "Keep descriptions concise",
        "Agent ID format: prefix + number (e.g., W01, W02)"
      ],
      "handoff": {
        "next": [ { "id": "W-04" } ],
        "conditions": [
          "agents_yaml_draft.md complete",
          "handoff_flow.md complete",
          "All phases have agents"
        ]
      }
    },
    {
      "id": "W-04",
      "slug": "artifacts",
      "role": "Artifact Design Agent",
      "purpose": "Define all artifacts with their metadata, categories, and ownership mapping.",
      "responsibilities": [
        "List all unique filenames from agents produces/consumes",
        "Add system artifacts (active_session.md, project_index.md)",
        "For each artifact, define: artifact_id, name, filename, description",
        "Assign category (planning, design, testing, documentation, governance)",
        "Determine if template is needed",
        "List sections if applicable",
        "Create ownership map showing producer/consumers"
      ],
      "workflow": {
        "entry_conditions": [
          "All agents defined",
          "Produces/consumes lists complete",
          "Handoff flow documented"
        ],
        "steps": [
          "List all unique filenames from agents produces/consumes",
          "Add system artifacts (active_session.md, project_index.md)",
          "For each artifact, define: artifact_id, name, filename, description",
          "Assign category (planning, design, testing, documentation, governance)",
          "Determine if template is needed",
          "List sections if applicable",
          "Create ownership map showing producer/consumers"
        ],
        "exit_conditions": [
          "Every filename in agents.yaml has an artifact entry",
          "Filenames are consistent (snake_case)",
          "Categories assigned appropriately",
          "Ownership map is complete"
        ]
      },
      "boundaries": {
        "in_scope": [
          "Artifact metadata definition",
          "Category assignment",
          "Ownership mapping",
          "Template requirements"
        ],
        "out_of_scope": [
          "Agent instruction writing",
          "Template implementation",
          "Testing"
        ]
      },
      "domain_rules": [
        "Filename MUST match exactly what's in agents.yaml",
        "Use snake_case for all filenames",
        "artifact_id format: ART-WXX-NNN"
      ],
      "handoff": {
        "next": [ { "id": "W-05" } ],
        "conditions": [
          "artifacts_yaml_draft.md complete",
          "artifact_ownership_map.md complete",
          "Human approves definitions"
        ]
      }
    },
    {
      "id": "W-05",
      "slug": "instructions",
      "role": "Instruction Writing Agent",
      "purpose": "Write detailed per-agent instructions with process steps, quality criteria, and constraints.",
      "responsibilities": [
        "Choose instruction format (Research or Planning style)",
        "For each agent, write purpose paragraph",
        "List process steps (numbered, action-oriented)",
        "Define quality criteria (measurable)",
        "List constraints (what NOT to do)",
        "Define handoff conditions",
        "Create governance.md with shared rules"
      ],
      "workflow": {
        "entry_conditions": [
          "All artifacts defined",
          "Ownership map complete",
          "Agent roles finalized"
        ],
        "steps": [
          "Choose instruction format (Research or Planning style)",
          "For each agent, write purpose paragraph",
          "List process steps (numbered, action-oriented)",
          "Define quality criteria (measurable)",
          "List constraints (what NOT to do)",
          "Define handoff conditions",
          "Create governance.md with shared rules"
        ],
        "exit_conditions": [
          "Every agent has instructions entry",
          "Purpose is clear and specific",
          "Process has 5-10 actionable steps",
          "At least 3 quality criteria per agent",
          "Constraints prevent scope creep",
          "governance.md covers shared patterns"
        ]
      },
      "boundaries": {
        "in_scope": [
          "Instruction writing",
          "Process definition",
          "Quality criteria",
          "Governance rules"
        ],
        "out_of_scope": [
          "Template creation",
          "Testing",
          "Documentation"
        ]
      },
      "domain_rules": [
        "Root key MUST be 'agents:' not 'instructions:'",
        "Use consistent format across all agents",
        "Keep process steps actionable"
      ],
      "handoff": {
        "next": [ { "id": "W-06" } ],
        "conditions": [
          "instructions_yaml_draft.md complete",
          "governance_md_draft.md complete",
          "All agents covered"
        ]
      }
    },
    {
      "id": "W-06",
      "slug": "templates",
      "role": "Template Creation Agent",
      "purpose": "Create prompt templates using mustache syntax for agent file generation.",
      "responsibilities": [
        "Create agent_header.md.tpl with YAML frontmatter",
        "Create agent_body.md.tpl with content sections",
        "Use mustache syntax: {{variable}} (NO spaces)",
        "Include: Mandate, Artifact Ownership, Domain Instructions",
        "Add workflow-specific sections if needed",
        "Test by generating one agent file",
        "Verify all variables substitute correctly"
      ],
      "workflow": {
        "entry_conditions": [
          "All instructions written",
          "Governance rules defined",
          "Agent definitions complete"
        ],
        "steps": [
          "Create agent_header.md.tpl with YAML frontmatter",
          "Create agent_body.md.tpl with content sections",
          "Use mustache syntax: {{variable}} (NO spaces)",
          "Include: Mandate, Artifact Ownership, Domain Instructions",
          "Add workflow-specific sections if needed",
          "Test by generating one agent file",
          "Verify all variables substitute correctly"
        ],
        "exit_conditions": [
          "Header has agent_id, slug, title, produces, consumes",
          "Body has Mandate, Artifact Ownership, Domain Instructions",
          "All {{variables}} substitute correctly",
          "No raw {{variable}} in generated output",
          "YAML frontmatter is valid"
        ]
      },
      "boundaries": {
        "in_scope": [
          "Template creation",
          "Mustache syntax usage",
          "Variable testing",
          "Frontmatter design"
        ],
        "out_of_scope": [
          "Full workflow testing",
          "Documentation",
          "Finalization"
        ]
      },
      "domain_rules": [
        "Use {{variable}} NOT {{ variable }}",
        "Do NOT use Jinja2 loops or conditionals",
        "Available variables: agent_id, title, description, slug, produces_list, consumes_list, produces_formatted, consumes_formatted, domain_instructions"
      ],
      "handoff": {
        "next": [ { "id": "W-07" } ],
        "conditions": [
          "agent_header_tpl.md complete",
          "agent_body_tpl.md complete",
          "template_test_output.md shows correct substitution"
        ]
      }
    },
    {
      "id": "W-07",
      "slug": "testing",
      "role": "Testing Agent",
      "purpose": "Validate the complete workflow through systematic testing of all components.",
      "responsibilities": [
        "Run: python3 -m scripts.cli.workflow list-workflows",
        "Run: python3 -m scripts.validation.validate_agents",
        "Run: python3 -m scripts.generation.generate_agents --workflow <name>",
        "Create test project: workflow init test_<name> --workflow <name> --description \"Test project for <name>\"",
        "Verify agent files generated correctly",
        "Test CLI commands: status, activate, handoff, decision",
        "Document all issues found",
        "Clean up test project"
      ],
      "workflow": {
        "entry_conditions": [
          "All templates created",
          "Variable substitution verified",
          "Workflow package complete"
        ],
        "steps": [
          "Run: python3 -m scripts.cli.workflow list-workflows",
          "Run: python3 -m scripts.validation.validate_agents",
          "Run: python3 -m scripts.generation.generate_agents --workflow <name>",
          "Create test project: workflow init test_<name> --workflow <name> --description \"Test project for <name>\"",
          "Verify agent files generated correctly",
          "Test CLI commands: status, activate, handoff, decision",
          "Document all issues found",
          "Clean up test project"
        ],
        "exit_conditions": [
          "list-workflows shows workflow",
          "validate_agents passes",
          "generate_agents creates all files",
          "Test project initializes correctly",
          "CLI commands work",
          "No critical issues"
        ]
      },
      "boundaries": {
        "in_scope": [
          "Workflow validation",
          "Agent generation testing",
          "CLI testing",
          "Issue documentation"
        ],
        "out_of_scope": [
          "Issue fixing (send back to appropriate phase)",
          "Documentation writing",
          "Finalization"
        ]
      },
      "domain_rules": [
        "Do NOT proceed with issues",
        "Fix issues before handoff",
        "Document all test results"
      ],
      "handoff": {
        "next": [ { "id": "W-08" } ],
        "conditions": [
          "validation_report.md shows all pass",
          "test_results.md complete",
          "Human approves for documentation"
        ]
      }
    },
    {
      "id": "W-08",
      "slug": "documentation",
      "role": "Documentation Agent",
      "purpose": "Create user documentation and finalize the workflow package for version control.",
      "responsibilities": [
        "Create README.md for the workflow",
        "Include: Quick Start, Agents table, Stages, Artifacts",
        "Update manifests/README.md with new workflow",
        "Generate global agent files",
        "Run final verification",
        "Prepare commit message",
        "Create final checklist"
      ],
      "workflow": {
        "entry_conditions": [
          "All tests pass",
          "No critical issues",
          "Human approves for documentation"
        ],
        "steps": [
          "Create README.md for the workflow",
          "Include: Quick Start, Agents table, Stages, Artifacts",
          "Update manifests/README.md with new workflow",
          "Generate global agent files",
          "Run final verification",
          "Prepare commit message",
          "Create final checklist"
        ],
        "exit_conditions": [
          "README.md is complete and helpful",
          "Central docs updated",
          "Global agent files generated",
          "Final checklist all green"
        ]
      },
      "boundaries": {
        "in_scope": [
          "README creation",
          "Central doc updates",
          "Final verification",
          "Commit preparation"
        ],
        "out_of_scope": [
          "Modifying other workflows",
          "Changing core scripts",
          "Non-workflow package files"
        ]
      },
      "domain_rules": [
        "Follow existing README patterns",
        "Do NOT modify other workflows",
        "Commit only workflow package files"
      ],
      "handoff": {
        "next": null,
        "conditions": [
          "workflow_readme.md complete",
          "final_checklist.md all passed",
          "Ready for git commit"
        ]
      }
    }
  ]
}
